<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SEVEN MINUTES PAST</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;}
html,body{
  width:100%;height:100%;
  overflow:hidden;
  background:#050611;
  font-family:Georgia,serif;
}

#viewport{
  position:fixed;
  top:0;
  left:50%;
  transform:translateX(-50%);
  width:393px;
  max-width:100vw;
  height:100vh;
  overflow:hidden;
  background:#050611;
}

#world{
  position:absolute;
  top:0;left:0;
  width:100%;
  height:200000px;
  will-change:transform;
}

/* ===================== */
/* GRADIENT DARKEN LOGIC */
/* ===================== */
#gradient{
  position:absolute;
  top:0;left:0;
  width:100%;
  height:200000px;
  pointer-events:none;
  background:linear-gradient(
    to bottom,
    #353966 0%,
    #14162f 20%,
    #0d0e1f 45%,
    #050611 75%
  );
}

/* ===================== */
/* TITLE SCREEN */
/* ===================== */
#title{
  position:absolute;
  top:25%;
  width:100%;
  text-align:center;
  color:#FFE7BF;
  z-index:200;
  transition:opacity 1.2s ease;
}
#title h1{
  font-size:28px;
  letter-spacing:4px;
  margin-bottom:25px;
}
#title p{
  font-size:14px;
  letter-spacing:2px;
}

/* ===================== */
/* PLAYER */
/* ===================== */
#player{
  position:absolute;
  left:50%;
  top:60%;
  transform:translate(-50%,-50%);
  width:140px;
  height:160px;
  pointer-events:none;
  z-index:50;
}
#player img{
  position:absolute;
  width:100%;
  height:100%;
  object-fit:contain;
}
#star-pass{opacity:0;}

#player.glow img{
  filter:brightness(2.5) drop-shadow(0 0 35px rgba(255,231,191,.8));
  transition:filter 2s ease;
}
#player.super img{
  filter:brightness(6) drop-shadow(0 0 120px white);
  transition:filter 1.5s ease;
}

/* ===================== */
/* ASSETS */
/* ===================== */
.asset{
  position:absolute;
  pointer-events:none;
  transition:opacity 1.4s ease;
}
.asset.fade{opacity:0;}

.asset img{
  width:100%;
  height:100%;
  object-fit:contain;
}

/* ===================== */
/* TEXT BUBBLE */
/* ===================== */
#text-bubble{
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  width:85vw;
  max-width:620px;
  padding:40px 50px;
  color:#FFE7BF;
  background:radial-gradient(
    ellipse at center,
    rgba(30,25,60,.95) 0%,
    rgba(5,6,17,.9) 100%
  );
  border-radius:22px;
  border:1px solid rgba(255,231,191,.3);
  box-shadow:0 0 60px rgba(240,153,66,.12);
  line-height:1.9;
  letter-spacing:.4px;
  text-align:center;
  white-space:pre-line;
  opacity:0;
  display:none;
  transition:opacity 1.2s ease;
  z-index:300;
}
#text-bubble.visible{opacity:1;}

/* ===================== */
/* EPHEMERAL TEXT */
/* ===================== */
#ephemeral{
  position:fixed;
  bottom:45%;
  left:50%;
  transform:translateX(-50%);
  text-align:center;
  color:#FFE7BF;
  font-size:16px;
  line-height:2.1;
  white-space:pre-line;
  opacity:0;
  display:none;
  transition:opacity 2.5s ease;
  z-index:250;
}
#ephemeral.visible{opacity:1;}

/* ===================== */
/* WHITE FLASH */
/* ===================== */
#white{
  position:fixed;
  top:0;left:0;
  width:100vw;height:100vh;
  background:white;
  opacity:0;
  display:none;
  transition:opacity 2s ease;
  z-index:400;
}

/* ===================== */
/* RESTART */
/* ===================== */
#restart{
  position:fixed;
  top:0;left:0;
  width:100vw;height:100vh;
  display:none;
  align-items:center;
  justify-content:center;
  background:#050611;
  z-index:500;
}
#restart span{
  color:#FFE7BF;
  font-size:20px;
  letter-spacing:4px;
  opacity:0;
  transition:opacity 3s ease;
}
#restart.visible span{opacity:1;}
#restart.active{cursor:pointer;}
</style>
</head>

<body>

<div id="viewport">
  <div id="world">
    <div id="gradient"></div>
  </div>

  <div id="player">
    <img src="Assets_Updated/assets.svg#star" id="star-main">
    <img src="Assets_Updated/assets.svg#star-pass" id="star-pass">
  </div>

  <div id="title">
    <h1>SEVEN MINUTES PAST</h1>
    <p>press ⬅ ⬆ ⬇ ➡ to start</p>
  </div>

  <div id="text-bubble"></div>
  <div id="ephemeral"></div>
  <div id="white"></div>

  <div id="restart"><span>PRESS ANYWHERE TO RESTART</span></div>
</div>

<script>
/* ================================================== */
/* CORE STATE */
/* ================================================== */

const state={
  started:false,
  phase:'title',
  playerX:196,
  playerY:0,
  cameraY:0,
  keys:{},
  assets:[],
  ending:false
};

const SPEED=4;
const WIDTH=393;
const PLAYER_W=140;
const PLAYER_H=160;
const COLLIDE=0.35;

const world=document.getElementById('world');
const player=document.getElementById('player');
const gradient=document.getElementById('gradient');
const title=document.getElementById('title');
const bubble=document.getElementById('text-bubble');
const ephemeral=document.getElementById('ephemeral');
const white=document.getElementById('white');
const restart=document.getElementById('restart');
const starMain=document.getElementById('star-main');
const starPass=document.getElementById('star-pass');

/* ================================================== */
/* ASSET CREATION */
/* ================================================== */

function createAsset(id,x,y,size,text=null,isFinal=false){
  const el=document.createElement('div');
  el.className='asset';
  el.style.width=size+'px';
  el.style.height=size+'px';
  el.style.left=x+'px';
  el.style.top=y+'px';
  el.innerHTML=`<img src="Assets_Updated/assets.svg#${id}">`;
  world.appendChild(el);

  state.assets.push({el,x,y,size,text,isFinal,collected:false});
}

function populateWorld(){

  // duplicate asteroids continuously
  for(let i=0;i<20;i++){
    createAsset("asteroid-1",Math.random()*280,800+i*800,100);
    createAsset("asteroid-2",Math.random()*250,1200+i*900,130);
  }

  // three stardust
  createAsset("stardust",160,2000,70,"STARDUST_1");
  createAsset("stardust",180,5500,70,"STARDUST_2");
  createAsset("stardust",160,10000,70,"STARDUST_3",true);

  // single objects
  createAsset("black-hole",110,4000,180,"BLACKHOLE");
  createAsset("dying-star",90,7000,200,"DYINGSTAR");
  createAsset("planet",100,8500,190,"PLANET");
}

populateWorld();

/* ================================================== */
/* MOVEMENT */
/* ================================================== */

document.addEventListener('keydown',e=>{
  if(['ArrowLeft','ArrowRight','ArrowUp','ArrowDown'].includes(e.key)){
    if(!state.started){
      state.started=true;
      state.phase='playing';
      title.style.opacity=0;
    }
    state.keys[e.key]=true;
  }
});
document.addEventListener('keyup',e=>state.keys[e.key]=false);

function updatePlayer(){
  if(state.phase!=='playing')return;

  if(state.keys.ArrowLeft)state.playerX=Math.max(PLAYER_W/2,state.playerX-SPEED);
  if(state.keys.ArrowRight)state.playerX=Math.min(WIDTH-PLAYER_W/2,state.playerX+SPEED);
  if(state.keys.ArrowUp)state.playerY=Math.max(0,state.playerY-SPEED);
  if(state.keys.ArrowDown)state.playerY+=SPEED;
}

function updateCamera(){
  const target=state.playerY-window.innerHeight*.6;
  state.cameraY+= (target-state.cameraY)*.08;
  if(state.cameraY<0)state.cameraY=0;
  world.style.transform=`translateY(${-state.cameraY}px)`;

  // progressive darkening (locks at darkest)
  const depth=Math.min(state.cameraY/9000,1);
  gradient.style.opacity=1-depth*.6;
}

function updatePlayerVisual(){
  player.style.left=state.playerX+'px';
}

/* ================================================== */
/* COLLISION */
/* ================================================== */

function checkCollisions(){
  if(state.phase!=='playing')return;

  const px=state.playerX-PLAYER_W/2;
  const py=state.playerY-PLAYER_H/2;

  state.assets.forEach(a=>{
    if(a.collected)return;

    const shrink=a.size*COLLIDE/2;
    const left=a.x+shrink;
    const right=a.x+a.size-shrink;
    const top=a.y+shrink;
    const bottom=a.y+a.size-shrink;

    if(px+PLAYER_W>left && px<right &&
       py+PLAYER_H>top && py<bottom){
         handleCollision(a);
       }
  });
}

function handleCollision(a){
  a.collected=true;
  if(a.text){
    state.phase='text';
    showText(a.text,()=>{
      a.el.classList.add('fade');
      if(a.isFinal){
        startEnding();
      }else{
        state.phase='playing';
      }
    });
  }else{
    a.el.classList.add('fade');
  }
}

/* ================================================== */
/* TEXT SYSTEM */
/* ================================================== */

function showText(id,callback){
  bubble.innerText=window[id];
  bubble.style.display='block';
  requestAnimationFrame(()=>bubble.classList.add('visible'));
  setTimeout(()=>{
    bubble.classList.remove('visible');
    setTimeout(()=>{
      bubble.style.display='none';
      callback();
    },1200);
  },9000);
}

/* ================================================== */
/* ENDING */
/* ================================================== */

function startEnding(){
  state.phase='ending';
  player.classList.add('glow');

  setTimeout(()=>{
    ephemeral.innerText=EPHEMERAL_FINAL_TEXT;
    ephemeral.style.display='block';
    requestAnimationFrame(()=>ephemeral.classList.add('visible'));
  },3000);

  setTimeout(()=>{
    ephemeral.classList.remove('visible');
  },9000);

  setTimeout(()=>{
    starMain.style.opacity=0;
    starPass.style.opacity=1;
    player.classList.remove('glow');
    player.classList.add('super');
  },11000);

  setTimeout(()=>{
    white.style.display='block';
    requestAnimationFrame(()=>white.style.opacity=1);
  },13000);

  setTimeout(()=>{
    white.style.opacity=0;
  },16000);

  setTimeout(()=>{
    white.style.display='none';
    restart.style.display='flex';
    setTimeout(()=>restart.classList.add('visible'),100);
  },18000);

  setTimeout(()=>{
    restart.classList.add('active');
    restart.addEventListener('click',()=>location.reload());
  },22000);
}

/* ================================================== */
/* LOOP */
/* ================================================== */

function loop(){
  updatePlayer();
  updateCamera();
  updatePlayerVisual();
  checkCollisions();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
